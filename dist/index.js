var nr=Object.defineProperty;var vt=e=>{throw TypeError(e)};var or=(e,t,r)=>t in e?nr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var d=(e,t,r)=>or(e,typeof t!="symbol"?t+"":t,r),Qe=(e,t,r)=>t.has(e)||vt("Cannot "+r);var o=(e,t,r)=>(Qe(e,t,"read from private field"),r?r.call(e):t.get(e)),p=(e,t,r)=>t.has(e)?vt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),f=(e,t,r,s)=>(Qe(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),y=(e,t,r)=>(Qe(e,t,"access private method"),r);var gt=(e,t,r,s)=>({set _(n){f(e,t,n,r)},get _(){return o(e,t,s)}});import{createServer as ir}from"http";import{Http2ServerRequest as Xe}from"http2";import{Readable as ar}from"stream";import yr from"crypto";var Je,Y=(Je=class extends Error{constructor(e,t){super(e,t)}},d(Je,"name","RequestError"),Je),cr=e=>e instanceof Y?e:new Y(e.message,{cause:e}),hr=global.Request,Re=class extends hr{constructor(e,t){typeof e=="object"&&ce in e&&(e=e[ce]()),typeof t?.body?.getReader<"u"&&(t.duplex??(t.duplex="half")),super(e,t)}},lr=(e,t,r,s)=>{let n=[],i=r.rawHeaders;for(let h=0;h<i.length;h+=2){let{[h]:c,[h+1]:l}=i;c.charCodeAt(0)!==58&&n.push([c,l])}let a={method:e,headers:n,signal:s.signal};if(e==="TRACE"){a.method="GET";let h=new Re(t,a);return Object.defineProperty(h,"method",{get(){return"TRACE"}}),h}return e==="GET"||e==="HEAD"||("rawBody"in r&&r.rawBody instanceof Buffer?a.body=new ReadableStream({start(h){h.enqueue(r.rawBody),h.close()}}):a.body=ar.toWeb(r)),new Re(t,a)},ce=Symbol("getRequestCache"),Ye=Symbol("requestCache"),Ze=Symbol("incomingKey"),_e=Symbol("urlKey"),K=Symbol("abortControllerKey"),fr=Symbol("getAbortController"),De={get method(){return this[Ze].method||"GET"},get url(){return this[_e]},[fr](){return this[ce](),this[K]},[ce](){return this[K]||(this[K]=new AbortController),this[Ye]||(this[Ye]=lr(this.method,this[_e],this[Ze],this[K]))}};["body","bodyUsed","cache","credentials","destination","headers","integrity","mode","redirect","referrer","referrerPolicy","signal","keepalive"].forEach(e=>{Object.defineProperty(De,e,{get(){return this[ce]()[e]}})});["arrayBuffer","blob","clone","formData","json","text"].forEach(e=>{Object.defineProperty(De,e,{value:function(){return this[ce]()[e]()}})});Object.setPrototypeOf(De,Re.prototype);var ur=(e,t)=>{let r=Object.create(De);r[Ze]=e;let s=e.url||"";if(s[0]!=="/"&&(s.startsWith("http://")||s.startsWith("https://"))){if(e instanceof Xe)throw new Y("Absolute URL for :path is not allowed in HTTP/2");try{let h=new URL(s);r[_e]=h.href}catch(h){throw new Y("Invalid absolute URL",{cause:h})}return r}let n=(e instanceof Xe?e.authority:e.headers.host)||t;if(!n)throw new Y("Missing host header");let i;if(e instanceof Xe){if(i=e.scheme,!(i==="http"||i==="https"))throw new Y("Unsupported scheme")}else i=e.socket&&e.socket.encrypted?"https":"http";let a=new URL(`${i}://${n}${s}`);if(a.hostname.length!==n.length&&a.hostname!==n.replace(/:\d+$/,""))throw new Y("Invalid host header");return r[_e]=a.href,r};function et(e,t){if(e.locked)throw new TypeError("ReadableStream is locked.");if(t.destroyed){e.cancel();return}let r=e.getReader();return t.on("close",s),t.on("error",s),r.read().then(i,s),r.closed.finally(()=>{t.off("close",s),t.off("error",s)});function s(a){r.cancel(a).catch(()=>{}),a&&t.destroy(a)}function n(){r.read().then(i,s)}function i({done:a,value:h}){try{if(a)t.end();else if(!t.write(h))t.once("drain",n);else return r.read().then(i,s)}catch(c){s(c)}}}var Et=e=>{let t={};e instanceof Headers||(e=new Headers(e??void 0));let r=[];for(let[s,n]of e)s==="set-cookie"?r.push(n):t[s]=n;return r.length>0&&(t["set-cookie"]=r),t["content-type"]??(t["content-type"]="text/plain; charset=UTF-8"),t},Le=Symbol("responseCache"),we=Symbol("getResponseCache"),ve=Symbol("cache"),$e=global.Response,ge,G,ae,he=(ae=class{constructor(t,r){p(this,ge);p(this,G);if(f(this,ge,t),r instanceof ae){let s=r[Le];if(s){f(this,G,s),this[we]();return}else f(this,G,o(r,G))}else f(this,G,r);if(typeof t=="string"||typeof t?.getReader<"u"){let s=r?.headers||{"content-type":"text/plain; charset=UTF-8"};s instanceof Headers&&(s=Et(s)),this[ve]=[r?.status||200,t,s]}}[we](){return delete this[ve],this[Le]||(this[Le]=new $e(o(this,ge),o(this,G)))}},ge=new WeakMap,G=new WeakMap,ae);["body","bodyUsed","headers","ok","redirected","status","statusText","trailers","type","url"].forEach(e=>{Object.defineProperty(he.prototype,e,{get(){return this[we]()[e]}})});["arrayBuffer","blob","clone","formData","json","text"].forEach(e=>{Object.defineProperty(he.prototype,e,{value:function(){return this[we]()[e]()}})});Object.setPrototypeOf(he,$e);Object.setPrototypeOf(he.prototype,$e.prototype);var tt=Reflect.ownKeys(new $e).find(e=>typeof e=="symbol"&&e.toString()==="Symbol(state)");tt||console.warn("Failed to find Response internal state key");function dr(e){if(!tt)return;e instanceof he&&(e=e[we]());let t=e[tt];return t&&t.body||void 0}var pr="x-hono-already-sent",mr=global.fetch;typeof global.crypto>"u"&&(global.crypto=yr);global.fetch=(e,t)=>(t={compress:!1,...t},mr(e,t));var br=/^no$/i,Rr=/^(application\/json\b|text\/(?!event-stream\b))/i,wr=()=>new Response(null,{status:400}),xt=e=>new Response(null,{status:e instanceof Error&&(e.name==="TimeoutError"||e.constructor.name==="TimeoutError")?504:500}),rt=(e,t)=>{let r=e instanceof Error?e:new Error("unknown error",{cause:e});r.code==="ERR_STREAM_PREMATURE_CLOSE"?console.info("The user aborted a request."):(console.error(e),t.headersSent||t.writeHead(500,{"Content-Type":"text/plain"}),t.end(`Error: ${r.message}`),t.destroy(r))},Ot=(e,t)=>{let[r,s,n]=e[ve];if(typeof s=="string")n["Content-Length"]=Buffer.byteLength(s),t.writeHead(r,n),t.end(s);else return t.writeHead(r,n),et(s,t)?.catch(i=>rt(i,t))},vr=async(e,t,r={})=>{if(e instanceof Promise)if(r.errorHandler)try{e=await e}catch(i){let a=await r.errorHandler(i);if(!a)return;e=a}else e=await e.catch(xt);if(ve in e)return Ot(e,t);let s=Et(e.headers),n=dr(e);if(n){let{length:i,source:a,stream:h}=n;if(!(a instanceof Uint8Array&&a.byteLength!==i)){i&&(s["content-length"]=i),t.writeHead(e.status,s),typeof a=="string"||a instanceof Uint8Array?t.end(a):a instanceof Blob?t.end(new Uint8Array(await a.arrayBuffer())):await et(h,t);return}}if(e.body){let{"transfer-encoding":i,"content-encoding":a,"content-length":h,"x-accel-buffering":c,"content-type":l}=s;if(i||a||h||c&&br.test(c)||!Rr.test(l))t.writeHead(e.status,s),await et(e.body,t);else{let u=await e.arrayBuffer();s["content-length"]=u.byteLength,t.writeHead(e.status,s),t.end(new Uint8Array(u))}}else s[pr]||(t.writeHead(e.status,s),t.end())},gr=(e,t={})=>(t.overrideGlobalObjects!==!1&&global.Request!==Re&&(Object.defineProperty(global,"Request",{value:Re}),Object.defineProperty(global,"Response",{value:he})),async(r,s)=>{let n,i;try{if(i=ur(r,t.hostname),s.on("close",()=>{i[K]&&(r.errored?i[K].abort(r.errored.toString()):s.writableFinished||i[K].abort("Client connection prematurely closed."))}),n=e(i,{incoming:r,outgoing:s}),ve in n)return Ot(n,s)}catch(a){if(n)return rt(a,s);if(t.errorHandler){if(n=await t.errorHandler(i?a:cr(a)),!n)return}else i?n=xt(a):n=wr()}try{return await vr(n,s,t)}catch(a){return rt(a,s)}}),Er=e=>{let t=e.fetch,r=gr(t,{hostname:e.hostname,overrideGlobalObjects:e.overrideGlobalObjects});return(e.createServer||ir)(e.serverOptions||{},r)},St=(e,t)=>{let r=Er(e);return r.listen(e?.port??3e3,e.hostname,()=>{let s=r.address();t&&t(s)}),r};var st=(e,t,r)=>(s,n)=>{let i=-1;return a(0);async function a(h){if(h<=i)throw new Error("next() called multiple times");i=h;let c,l=!1,u;if(e[h]?(u=e[h][0][0],s.req.routeIndex=h):u=h===e.length&&n||void 0,u)try{c=await u(s,()=>a(h+1))}catch(m){if(m instanceof Error&&t)s.error=m,c=await t(m,s),l=!0;else throw m}else s.finalized===!1&&r&&(c=await r(s));return c&&(s.finalized===!1||l)&&(s.res=c),s}};var Pt=async(e,t=Object.create(null))=>{let{all:r=!1,dot:s=!1}=t,i=(e instanceof ke?e.raw.headers:e.headers).get("Content-Type");return i?.startsWith("multipart/form-data")||i?.startsWith("application/x-www-form-urlencoded")?xr(e,{all:r,dot:s}):{}};async function xr(e,t){let r=await e.formData();return r?Or(r,t):{}}function Or(e,t){let r=Object.create(null);return e.forEach((s,n)=>{t.all||n.endsWith("[]")?Sr(r,n,s):r[n]=s}),t.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(Pr(r,s,n),delete r[s])}),r}var Sr=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:e[t]=r},Pr=(e,t,r)=>{let s=e,n=t.split(".");n.forEach((i,a)=>{a===n.length-1?s[i]=r:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})};var ot=e=>{let t=e.split("/");return t[0]===""&&t.shift(),t},jt=e=>{let{groups:t,path:r}=jr(e),s=ot(r);return Ar(s,t)},jr=e=>{let t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{let n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},Ar=(e,t)=>{for(let r=t.length-1;r>=0;r--){let[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},Me={},it=(e,t)=>{if(e==="*")return"*";let r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){let s=`${e}#${t}`;return Me[s]||(r[2]?Me[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:Me[s]=[e,r[1],!0]),Me[s]}return null},at=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},Hr=e=>at(e,decodeURI),ct=e=>{let t=e.url,r=t.indexOf("/",8),s=r;for(;s<t.length;s++){let n=t.charCodeAt(s);if(n===37){let i=t.indexOf("?",s),a=t.slice(r,i===-1?void 0:i);return Hr(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return t.slice(r,s)};var At=e=>{let t=ct(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},J=(e,t,...r)=>(r.length&&(t=J(t,...r)),`${e?.[0]==="/"?"":"/"}${e}${t==="/"?"":`${e?.at(-1)==="/"?"":"/"}${t?.[0]==="/"?t.slice(1):t}`}`),Ie=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;let t=e.split("/"),r=[],s="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);let i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,a)=>a.indexOf(n)===i)},nt=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?ht(e):e):e,Ht=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf(`?${t}`,8);for(a===-1&&(a=e.indexOf(`&${t}`,8));a!==-1;){let h=e.charCodeAt(a+t.length+1);if(h===61){let c=a+t.length+2,l=e.indexOf("&",c);return nt(e.slice(c,l===-1?void 0:l))}else if(h==38||isNaN(h))return"";a=e.indexOf(`&${t}`,a+1)}if(s=/[%+]/.test(e),!s)return}let n={};s??(s=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){let a=e.indexOf("&",i+1),h=e.indexOf("=",i);h>a&&a!==-1&&(h=-1);let c=e.slice(i+1,h===-1?a===-1?void 0:a:h);if(s&&(c=nt(c)),i=a,c==="")continue;let l;h===-1?l="":(l=e.slice(h+1,a===-1?void 0:a),s&&(l=nt(l))),r?(n[c]&&Array.isArray(n[c])||(n[c]=[]),n[c].push(l)):n[c]??(n[c]=l)}return t?n[t]:n},Tt=Ht,Ct=(e,t)=>Ht(e,t,!0),ht=decodeURIComponent;var Lt=e=>at(e,ht),le,T,k,Dt,$t,lt,W,_t,ke=(_t=class{constructor(e,t="/",r=[[]]){p(this,k);d(this,"raw");p(this,le);p(this,T);d(this,"routeIndex",0);d(this,"path");d(this,"bodyCache",{});p(this,W,e=>{let{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;let n=Object.keys(t)[0];return n?t[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,f(this,T,r),f(this,le,{})}param(e){return e?y(this,k,Dt).call(this,e):y(this,k,$t).call(this)}query(e){return Tt(this.url,e)}queries(e){return Ct(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;let t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await Pt(this,e))}json(){return o(this,W).call(this,"json")}text(){return o(this,W).call(this,"text")}arrayBuffer(){return o(this,W).call(this,"arrayBuffer")}blob(){return o(this,W).call(this,"blob")}formData(){return o(this,W).call(this,"formData")}addValidatedData(e,t){o(this,le)[e]=t}valid(e){return o(this,le)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return o(this,T)[0].map(([[,e]])=>e)}get routePath(){return o(this,T)[0].map(([[,e]])=>e)[this.routeIndex].path}},le=new WeakMap,T=new WeakMap,k=new WeakSet,Dt=function(e){let t=o(this,T)[0][this.routeIndex][1][e],r=y(this,k,lt).call(this,t);return r?/\%/.test(r)?Lt(r):r:void 0},$t=function(){let e={},t=Object.keys(o(this,T)[0][this.routeIndex][1]);for(let r of t){let s=y(this,k,lt).call(this,o(this,T)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(e[r]=/\%/.test(s)?Lt(s):s)}return e},lt=function(e){return o(this,T)[1]?o(this,T)[1][e]:e},W=new WeakMap,_t);var kt={Stringify:1,BeforeStream:2,Stream:3},Tr=(e,t)=>{let r=new String(e);return r.isEscaped=!0,r.callbacks=t,r};var ft=async(e,t,r,s,n)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));let i=e.callbacks;if(!i?.length)return Promise.resolve(e);n?n[0]+=e:n=[e];let a=Promise.all(i.map(h=>h({phase:t,buffer:n,context:s}))).then(h=>Promise.all(h.filter(Boolean).map(c=>ft(c,t,!1,s,n))).then(()=>n[0]));return r?Tr(await a,i):a};var Cr="text/plain; charset=UTF-8",ut=(e,t={})=>{for(let r of Object.keys(t))e.set(r,t[r]);return e},Ee,xe,M,Z,I,w,g,D,q,Oe,fe,ue,Se,Pe,j,H,Mt,It=(Mt=class{constructor(e,t){p(this,j);p(this,Ee);p(this,xe);d(this,"env",{});p(this,M);d(this,"finalized",!1);d(this,"error");p(this,Z,200);p(this,I);p(this,w);p(this,g);p(this,D);p(this,q,!0);p(this,Oe);p(this,fe);p(this,ue);p(this,Se);p(this,Pe);d(this,"render",(...e)=>(o(this,fe)??f(this,fe,t=>this.html(t)),o(this,fe).call(this,...e)));d(this,"setLayout",e=>f(this,Oe,e));d(this,"getLayout",()=>o(this,Oe));d(this,"setRenderer",e=>{f(this,fe,e)});d(this,"header",(e,t,r)=>{if(t===void 0){o(this,w)?o(this,w).delete(e):o(this,g)&&delete o(this,g)[e.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(e);return}r?.append?(o(this,w)||(f(this,q,!1),f(this,w,new Headers(o(this,g))),f(this,g,{})),o(this,w).append(e,t)):o(this,w)?o(this,w).set(e,t):(o(this,g)??f(this,g,{}),o(this,g)[e.toLowerCase()]=t),this.finalized&&(r?.append?this.res.headers.append(e,t):this.res.headers.set(e,t))});d(this,"status",e=>{f(this,q,!1),f(this,Z,e)});d(this,"set",(e,t)=>{o(this,M)??f(this,M,new Map),o(this,M).set(e,t)});d(this,"get",e=>o(this,M)?o(this,M).get(e):void 0);d(this,"newResponse",(...e)=>y(this,j,H).call(this,...e));d(this,"body",(e,t,r)=>typeof t=="number"?y(this,j,H).call(this,e,t,r):y(this,j,H).call(this,e,t));d(this,"text",(e,t,r)=>{if(!o(this,g)){if(o(this,q)&&!r&&!t)return new Response(e);f(this,g,{})}return o(this,g)["content-type"]=Cr,typeof t=="number"?y(this,j,H).call(this,e,t,r):y(this,j,H).call(this,e,t)});d(this,"json",(e,t,r)=>{let s=JSON.stringify(e);return o(this,g)??f(this,g,{}),o(this,g)["content-type"]="application/json",typeof t=="number"?y(this,j,H).call(this,s,t,r):y(this,j,H).call(this,s,t)});d(this,"html",(e,t,r)=>(o(this,g)??f(this,g,{}),o(this,g)["content-type"]="text/html; charset=UTF-8",typeof e=="object"?ft(e,kt.Stringify,!1,{}).then(s=>typeof t=="number"?y(this,j,H).call(this,s,t,r):y(this,j,H).call(this,s,t)):typeof t=="number"?y(this,j,H).call(this,e,t,r):y(this,j,H).call(this,e,t)));d(this,"redirect",(e,t)=>(o(this,w)??f(this,w,new Headers),o(this,w).set("Location",String(e)),this.newResponse(null,t??302)));d(this,"notFound",()=>(o(this,ue)??f(this,ue,()=>new Response),o(this,ue).call(this,this)));f(this,Ee,e),t&&(f(this,I,t.executionCtx),this.env=t.env,f(this,ue,t.notFoundHandler),f(this,Pe,t.path),f(this,Se,t.matchResult))}get req(){return o(this,xe)??f(this,xe,new ke(o(this,Ee),o(this,Pe),o(this,Se))),o(this,xe)}get event(){if(o(this,I)&&"respondWith"in o(this,I))return o(this,I);throw Error("This context has no FetchEvent")}get executionCtx(){if(o(this,I))return o(this,I);throw Error("This context has no ExecutionContext")}get res(){return f(this,q,!1),o(this,D)||f(this,D,new Response("404 Not Found",{status:404}))}set res(e){if(f(this,q,!1),o(this,D)&&e)try{for(let[t,r]of o(this,D).headers.entries())if(t!=="content-type")if(t==="set-cookie"){let s=o(this,D).headers.getSetCookie();e.headers.delete("set-cookie");for(let n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}catch(t){if(t instanceof TypeError&&t.message.includes("immutable")){this.res=new Response(e.body,{headers:e.headers,status:e.status});return}else throw t}f(this,D,e),this.finalized=!0}get var(){return o(this,M)?Object.fromEntries(o(this,M)):{}}},Ee=new WeakMap,xe=new WeakMap,M=new WeakMap,Z=new WeakMap,I=new WeakMap,w=new WeakMap,g=new WeakMap,D=new WeakMap,q=new WeakMap,Oe=new WeakMap,fe=new WeakMap,ue=new WeakMap,Se=new WeakMap,Pe=new WeakMap,j=new WeakSet,H=function(e,t,r){if(o(this,q)&&!r&&!t&&o(this,Z)===200)return new Response(e,{headers:o(this,g)});if(t&&typeof t!="number"){let n=new Headers(t.headers);o(this,w)&&o(this,w).forEach((a,h)=>{h==="set-cookie"?n.append(h,a):n.set(h,a)});let i=ut(n,o(this,g));return new Response(e,{headers:i,status:t.status??o(this,Z)})}let s=typeof t=="number"?t:o(this,Z);o(this,g)??f(this,g,{}),o(this,w)??f(this,w,new Headers),ut(o(this,w),o(this,g)),o(this,D)&&(o(this,D).headers.forEach((n,i)=>{i==="set-cookie"?o(this,w)?.append(i,n):o(this,w)?.set(i,n)}),ut(o(this,w),o(this,g))),r??(r={});for(let[n,i]of Object.entries(r))if(typeof i=="string")o(this,w).set(n,i);else{o(this,w).delete(n);for(let a of i)o(this,w).append(n,a)}return new Response(e,{status:s,headers:o(this,w)})},Mt);var v="ALL",qt="all",Nt=["get","post","put","delete","options","patch"],qe="Can not add a route since the matcher is already built.",Ne=class extends Error{};var Bt="__COMPOSED_HANDLER";var Lr=e=>e.text("404 Not Found",404),Ut=(e,t)=>"getResponse"in e?e.getResponse():(console.error(e),t.text("Internal Server Error",500)),C,E,Kt,N,ee,Be,Ue,Ft,dt=(Ft=class{constructor(e={}){p(this,E);d(this,"get");d(this,"post");d(this,"put");d(this,"delete");d(this,"options");d(this,"patch");d(this,"all");d(this,"on");d(this,"use");d(this,"router");d(this,"getPath");d(this,"_basePath","/");p(this,C,"/");d(this,"routes",[]);p(this,N,Lr);d(this,"errorHandler",Ut);d(this,"onError",e=>(this.errorHandler=e,this));d(this,"notFound",e=>(f(this,N,e),this));d(this,"fetch",(e,...t)=>y(this,E,Ue).call(this,e,t[1],t[0],e.method));d(this,"request",(e,t,r,s)=>e instanceof Request?this.fetch(t?new Request(e,t):e,r,s):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${J("/",e)}`,t),r,s)));d(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(y(this,E,Ue).call(this,e.request,e,void 0,e.request.method))})});[...Nt,qt].forEach(n=>{this[n]=(i,...a)=>(typeof i=="string"?f(this,C,i):y(this,E,ee).call(this,n,o(this,C),i),a.forEach(h=>{y(this,E,ee).call(this,n,o(this,C),h)}),this)}),this.on=(n,i,...a)=>{for(let h of[i].flat()){f(this,C,h);for(let c of[n].flat())a.map(l=>{y(this,E,ee).call(this,c.toUpperCase(),o(this,C),l)})}return this},this.use=(n,...i)=>(typeof n=="string"?f(this,C,n):(f(this,C,"*"),i.unshift(n)),i.forEach(a=>{y(this,E,ee).call(this,v,o(this,C),a)}),this);let{strict:r,...s}=e;Object.assign(this,s),this.getPath=r??!0?e.getPath??ct:At}route(e,t){let r=this.basePath(e);return t.routes.map(s=>{var i;let n;t.errorHandler===Ut?n=s.handler:(n=async(a,h)=>(await st([],t.errorHandler)(a,()=>s.handler(a,h))).res,n[Bt]=s.handler),y(i=r,E,ee).call(i,s.method,s.path,n)}),this}basePath(e){let t=y(this,E,Kt).call(this);return t._basePath=J(this._basePath,e),t}mount(e,t,r){let s,n;r&&(typeof r=="function"?n=r:(n=r.optionHandler,s=r.replaceRequest));let i=n?h=>{let c=n(h);return Array.isArray(c)?c:[c]}:h=>{let c;try{c=h.executionCtx}catch{}return[h.env,c]};s||(s=(()=>{let h=J(this._basePath,e),c=h==="/"?0:h.length;return l=>{let u=new URL(l.url);return u.pathname=u.pathname.slice(c)||"/",new Request(u,l)}})());let a=async(h,c)=>{let l=await t(s(h.req.raw),...i(h));if(l)return l;await c()};return y(this,E,ee).call(this,v,J(e,"*"),a),this}},C=new WeakMap,E=new WeakSet,Kt=function(){let e=new dt({router:this.router,getPath:this.getPath});return e.routes=this.routes,e},N=new WeakMap,ee=function(e,t,r){e=e.toUpperCase(),t=J(this._basePath,t);let s={path:t,method:e,handler:r};this.router.add(e,t,[r,s]),this.routes.push(s)},Be=function(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e},Ue=function(e,t,r,s){if(s==="HEAD")return(async()=>new Response(null,await y(this,E,Ue).call(this,e,t,r,"GET")))();let n=this.getPath(e,{env:r}),i=this.router.match(s,n),a=new It(e,{path:n,matchResult:i,env:r,executionCtx:t,notFoundHandler:o(this,N)});if(i[0].length===1){let c;try{c=i[0][0][0][0](a,async()=>{a.res=await o(this,N).call(this,a)})}catch(l){return y(this,E,Be).call(this,l,a)}return c instanceof Promise?c.then(l=>l||(a.finalized?a.res:o(this,N).call(this,a))).catch(l=>y(this,E,Be).call(this,l,a)):c??o(this,N).call(this,a)}let h=st(i[0],this.errorHandler,o(this,N));return(async()=>{try{let c=await h(a);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return y(this,E,Be).call(this,c,a)}})()},Ft);var Fe="[^/]+",je=".*",Ae="(?:|/.*)",de=Symbol(),_r=new Set(".\\+*[^]$()");function Dr(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===je||e===Ae?1:t===je||t===Ae?-1:e===Fe?1:t===Fe?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var te,re,L,Gt,Ke=(Gt=class{constructor(){p(this,te);p(this,re);p(this,L,Object.create(null))}insert(e,t,r,s,n){if(e.length===0){if(o(this,te)!==void 0)throw de;if(n)return;f(this,te,t);return}let[i,...a]=e,h=i==="*"?a.length===0?["","",je]:["","",Fe]:i==="/*"?["","",Ae]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),c;if(h){let l=h[1],u=h[2]||Fe;if(l&&h[2]&&(u=u.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(u)))throw de;if(c=o(this,L)[u],!c){if(Object.keys(o(this,L)).some(m=>m!==je&&m!==Ae))throw de;if(n)return;c=o(this,L)[u]=new Ke,l!==""&&f(c,re,s.varIndex++)}!n&&l!==""&&r.push([l,o(c,re)])}else if(c=o(this,L)[i],!c){if(Object.keys(o(this,L)).some(l=>l.length>1&&l!==je&&l!==Ae))throw de;if(n)return;c=o(this,L)[i]=new Ke}c.insert(a,t,r,s,n)}buildRegExpStr(){let t=Object.keys(o(this,L)).sort(Dr).map(r=>{let s=o(this,L)[r];return(typeof o(s,re)=="number"?`(${r})@${o(s,re)}`:_r.has(r)?`\\${r}`:r)+s.buildRegExpStr()});return typeof o(this,te)=="number"&&t.unshift(`#${o(this,te)}`),t.length===0?"":t.length===1?t[0]:"(?:"+t.join("|")+")"}},te=new WeakMap,re=new WeakMap,L=new WeakMap,Gt);var Ge,He,Wt,Vt=(Wt=class{constructor(){p(this,Ge,{varIndex:0});p(this,He,new Ke)}insert(e,t,r){let s=[],n=[];for(let a=0;;){let h=!1;if(e=e.replace(/\{[^}]+\}/g,c=>{let l=`@\\${a}`;return n[a]=[l,c],a++,h=!0,l}),!h)break}let i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){let[h]=n[a];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(h)!==-1){i[c]=i[c].replace(h,n[a][1]);break}}return o(this,He).insert(i,t,s,o(this,Ge),r),s}buildRegExp(){let e=o(this,He).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0,r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,a)=>i!==void 0?(r[++t]=Number(i),"$()"):(a!==void 0&&(s[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,s]}},Ge=new WeakMap,He=new WeakMap,Wt);var Qt=[],$r=[/^$/,[],Object.create(null)],We=Object.create(null);function Xt(e){return We[e]??(We[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function kr(){We=Object.create(null)}function Mr(e){let t=new Vt,r=[];if(e.length===0)return $r;let s=e.map(l=>[!/\*|\/:/.test(l[0]),...l]).sort(([l,u],[m,b])=>l?1:m?-1:u.length-b.length),n=Object.create(null);for(let l=0,u=-1,m=s.length;l<m;l++){let[b,x,R]=s[l];b?n[x]=[R.map(([A])=>[A,Object.create(null)]),Qt]:u++;let P;try{P=t.insert(x,u,b)}catch(A){throw A===de?new Ne(x):A}b||(r[u]=R.map(([A,ie])=>{let be=Object.create(null);for(ie-=1;ie>=0;ie--){let[_,Ve]=P[ie];be[_]=Ve}return[A,be]}))}let[i,a,h]=t.buildRegExp();for(let l=0,u=r.length;l<u;l++)for(let m=0,b=r[l].length;m<b;m++){let x=r[l][m]?.[1];if(!x)continue;let R=Object.keys(x);for(let P=0,A=R.length;P<A;P++)x[R[P]]=h[x[R[P]]]}let c=[];for(let l in a)c[l]=r[a[l]];return[i,c,n]}function pe(e,t){if(e){for(let r of Object.keys(e).sort((s,n)=>n.length-s.length))if(Xt(r).test(t))return[...e[r]]}}var V,z,ye,Yt,Jt,zt,pt=(zt=class{constructor(){p(this,ye);d(this,"name","RegExpRouter");p(this,V);p(this,z);f(this,V,{[v]:Object.create(null)}),f(this,z,{[v]:Object.create(null)})}add(e,t,r){var h;let s=o(this,V),n=o(this,z);if(!s||!n)throw new Error(qe);s[e]||[s,n].forEach(c=>{c[e]=Object.create(null),Object.keys(c[v]).forEach(l=>{c[e][l]=[...c[v][l]]})}),t==="/*"&&(t="*");let i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){let c=Xt(t);e===v?Object.keys(s).forEach(l=>{var u;(u=s[l])[t]||(u[t]=pe(s[l],t)||pe(s[v],t)||[])}):(h=s[e])[t]||(h[t]=pe(s[e],t)||pe(s[v],t)||[]),Object.keys(s).forEach(l=>{(e===v||e===l)&&Object.keys(s[l]).forEach(u=>{c.test(u)&&s[l][u].push([r,i])})}),Object.keys(n).forEach(l=>{(e===v||e===l)&&Object.keys(n[l]).forEach(u=>c.test(u)&&n[l][u].push([r,i]))});return}let a=Ie(t)||[t];for(let c=0,l=a.length;c<l;c++){let u=a[c];Object.keys(n).forEach(m=>{var b;(e===v||e===m)&&((b=n[m])[u]||(b[u]=[...pe(s[m],u)||pe(s[v],u)||[]]),n[m][u].push([r,i-l+c+1]))})}}match(e,t){kr();let r=y(this,ye,Yt).call(this);return this.match=(s,n)=>{let i=r[s]||r[v],a=i[2][n];if(a)return a;let h=n.match(i[0]);if(!h)return[[],Qt];let c=h.indexOf("",1);return[i[1][c],h]},this.match(e,t)}},V=new WeakMap,z=new WeakMap,ye=new WeakSet,Yt=function(){let e=Object.create(null);return Object.keys(o(this,z)).concat(Object.keys(o(this,V))).forEach(t=>{e[t]||(e[t]=y(this,ye,Jt).call(this,t))}),f(this,V,f(this,z,void 0)),e},Jt=function(e){let t=[],r=e===v;return[o(this,V),o(this,z)].forEach(s=>{let n=s[e]?Object.keys(s[e]).map(i=>[i,s[e][i]]):[];n.length!==0?(r||(r=!0),t.push(...n)):e!==v&&t.push(...Object.keys(s[v]).map(i=>[i,s[v][i]]))}),r?Mr(t):null},zt);var Q,B,Zt,yt=(Zt=class{constructor(e){d(this,"name","SmartRouter");p(this,Q,[]);p(this,B,[]);f(this,Q,e.routers)}add(e,t,r){if(!o(this,B))throw new Error(qe);o(this,B).push([e,t,r])}match(e,t){if(!o(this,B))throw new Error("Fatal error");let r=o(this,Q),s=o(this,B),n=r.length,i=0,a;for(;i<n;i++){let h=r[i];try{for(let c=0,l=s.length;c<l;c++)h.add(...s[c]);a=h.match(e,t)}catch(c){if(c instanceof Ne)continue;throw c}this.match=h.match.bind(h),f(this,Q,[h]),f(this,B,void 0);break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(o(this,B)||o(this,Q).length!==1)throw new Error("No active router has been determined yet.");return o(this,Q)[0]}},Q=new WeakMap,B=new WeakMap,Zt);var Te=Object.create(null),X,S,ne,me,O,U,se,er,mt=(er=class{constructor(e,t,r){p(this,U);p(this,X);p(this,S);p(this,ne);p(this,me,0);p(this,O,Te);if(f(this,S,r||Object.create(null)),f(this,X,[]),e&&t){let s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},f(this,X,[s])}f(this,ne,[])}insert(e,t,r){f(this,me,++gt(this,me)._);let s=this,n=jt(t),i=[];for(let c=0,l=n.length;c<l;c++){let u=n[c],m=n[c+1],b=it(u,m),x=Array.isArray(b)?b[0]:u;if(Object.keys(o(s,S)).includes(x)){s=o(s,S)[x];let R=it(u,m);R&&i.push(R[1]);continue}o(s,S)[x]=new mt,b&&(o(s,ne).push(b),i.push(b[1])),s=o(s,S)[x]}let a=Object.create(null),h={handler:r,possibleKeys:i.filter((c,l,u)=>u.indexOf(c)===l),score:o(this,me)};return a[e]=h,o(s,X).push(a),s}search(e,t){let r=[];f(this,O,Te);let n=[this],i=ot(t),a=[];for(let h=0,c=i.length;h<c;h++){let l=i[h],u=h===c-1,m=[];for(let b=0,x=n.length;b<x;b++){let R=n[b],P=o(R,S)[l];P&&(f(P,O,o(R,O)),u?(o(P,S)["*"]&&r.push(...y(this,U,se).call(this,o(P,S)["*"],e,o(R,O))),r.push(...y(this,U,se).call(this,P,e,o(R,O)))):m.push(P));for(let A=0,ie=o(R,ne).length;A<ie;A++){let be=o(R,ne)[A],_=o(R,O)===Te?{}:{...o(R,O)};if(be==="*"){let F=o(R,S)["*"];F&&(r.push(...y(this,U,se).call(this,F,e,o(R,O))),f(F,O,_),m.push(F));continue}if(l==="")continue;let[Ve,wt,Ce]=be,$=o(R,S)[Ve],sr=i.slice(h).join("/");if(Ce instanceof RegExp){let F=Ce.exec(sr);if(F){if(_[wt]=F[0],r.push(...y(this,U,se).call(this,$,e,o(R,O),_)),Object.keys(o($,S)).length){f($,O,_);let ze=F[0].match(/\//)?.length??0;(a[ze]||(a[ze]=[])).push($)}continue}}(Ce===!0||Ce.test(l))&&(_[wt]=l,u?(r.push(...y(this,U,se).call(this,$,e,_,o(R,O))),o($,S)["*"]&&r.push(...y(this,U,se).call(this,o($,S)["*"],e,_,o(R,O)))):(f($,O,_),m.push($)))}}n=m.concat(a.shift()??[])}return r.length>1&&r.sort((h,c)=>h.score-c.score),[r.map(({handler:h,params:c})=>[h,c])]}},X=new WeakMap,S=new WeakMap,ne=new WeakMap,me=new WeakMap,O=new WeakMap,U=new WeakSet,se=function(e,t,r,s){let n=[];for(let i=0,a=o(e,X).length;i<a;i++){let h=o(e,X)[i],c=h[t]||h[v],l={};if(c!==void 0&&(c.params=Object.create(null),n.push(c),r!==Te||s&&s!==Te))for(let u=0,m=c.possibleKeys.length;u<m;u++){let b=c.possibleKeys[u],x=l[c.score];c.params[b]=s?.[b]&&!x?s[b]:r[b]??s?.[b],l[c.score]=!0}}return n},er);var oe,tr,bt=(tr=class{constructor(){d(this,"name","TrieRouter");p(this,oe);f(this,oe,new mt)}add(e,t,r){let s=Ie(t);if(s){for(let n=0,i=s.length;n<i;n++)o(this,oe).insert(e,s[n],r);return}o(this,oe).insert(e,t,r)}match(e,t){return o(this,oe).search(e,t)}},oe=new WeakMap,tr);var Rt=class extends dt{constructor(e={}){super(e),this.router=e.router??new yt({routers:[new pt,new bt]})}};var rr=new Rt;rr.get("/",e=>e.text("Hello Standard Versioning!"));St({fetch:rr.fetch,port:3e3},e=>{console.log(`Server is running on http://localhost:${e.port}`)});
//# sourceMappingURL=index.js.map
